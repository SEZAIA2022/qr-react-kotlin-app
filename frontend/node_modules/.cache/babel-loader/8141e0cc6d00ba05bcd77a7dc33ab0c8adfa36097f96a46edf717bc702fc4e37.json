{"ast":null,"code":"import _objectSpread from\"/opt/myapp/qr-react-kotlin-app/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useState,useRef}from'react';import{useNavigate,Link}from'react-router-dom';import axios from'axios';import{FiEye,FiEyeOff}from'react-icons/fi';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const Login=_ref=>{let{setIsAuthenticated}=_ref;const[email,setEmail]=useState('');const[password,setPassword]=useState('');const[showPassword,setShowPassword]=useState(false);const[message,setMessage]=useState('');const emailRef=useRef(null);// ref pour focus email\nconst navigate=useNavigate();const emailRegex=/^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;const handleSubmit=async e=>{e.preventDefault();if(!email||!password){setMessage('Please enter your email and password.');setEmail('');setPassword('');if(emailRef.current)emailRef.current.focus();return;}if(!emailRegex.test(email)){setMessage('Please enter a valid email address.');setEmail('');setPassword('');if(emailRef.current)emailRef.current.focus();return;}try{const res=await axios.post(\"\".concat(process.env.REACT_APP_API_URL,\"/api/login_web\"),{email,password});if(res.data.status==='success'){const role=res.data.role||'';const application=res.data.application||'';const expiryTime=Date.now()+60*1000;// 1 minute pour test\nlocalStorage.setItem('isAuthenticated','true');localStorage.setItem('userEmail',email);localStorage.setItem('userRole',role);localStorage.setItem('userApplication',application);localStorage.setItem('authExpiry',expiryTime.toString());setIsAuthenticated(true,email,role,application);setMessage('');navigate('/');// redirection après succès\n}else{setMessage(res.data.message||'Unknown error.');setEmail('');setPassword('');if(emailRef.current)emailRef.current.focus();}}catch(err){if(err.response&&err.response.data&&err.response.data.message){setMessage(err.response.data.message);}else{setMessage('Server or network error.');}setEmail('');setPassword('');if(emailRef.current)emailRef.current.focus();}};return/*#__PURE__*/_jsxs(\"div\",{style:containerStyle,children:[/*#__PURE__*/_jsx(\"h2\",{children:\"Login\"}),message&&/*#__PURE__*/_jsx(\"p\",{style:messageStyle,children:message}),/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleSubmit,style:formStyle,children:[/*#__PURE__*/_jsx(\"input\",{ref:emailRef,type:\"text\",placeholder:\"Email\",value:email,onChange:e=>setEmail(e.target.value),style:inputStyle}),/*#__PURE__*/_jsxs(\"div\",{style:{position:'relative'},children:[/*#__PURE__*/_jsx(\"input\",{type:showPassword?'text':'password',placeholder:\"Password\",value:password,onChange:e=>setPassword(e.target.value),style:_objectSpread(_objectSpread({},inputStyle),{},{paddingRight:'40px'})}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:()=>setShowPassword(!showPassword),style:eyeButtonStyle,\"aria-label\":showPassword?'Hide password':'Show password',children:showPassword?/*#__PURE__*/_jsx(FiEyeOff,{}):/*#__PURE__*/_jsx(FiEye,{})})]}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",style:buttonStyle,children:\"Login\"})]}),/*#__PURE__*/_jsx(\"p\",{children:/*#__PURE__*/_jsx(Link,{to:\"/forgot-password\",style:{fontSize:'14px'},children:\"Forgot password?\"})}),/*#__PURE__*/_jsxs(\"p\",{children:[\"Don't have an account? \",/*#__PURE__*/_jsx(Link,{to:\"/signup\",children:\"Sign up\"})]})]});};// Styles\nconst containerStyle={maxWidth:'400px',margin:'auto',padding:'20px',border:'1px solid #ddd',borderRadius:'8px',backgroundColor:'#f9faff',fontFamily:\"'Segoe UI', Tahoma, Geneva, Verdana, sans-serif\"};const formStyle={display:'flex',flexDirection:'column',gap:'15px'};const inputStyle={padding:'10px',fontSize:'16px',borderRadius:'8px',border:'1.5px solid #ccc',width:'100%',boxSizing:'border-box'};const eyeButtonStyle={position:'absolute',right:'10px',top:'50%',transform:'translateY(-50%)',background:'transparent',border:'none',cursor:'pointer',fontSize:'18px'};const buttonStyle={backgroundColor:'#007bff',color:'#fff',fontWeight:'bold',border:'none',padding:'12px',borderRadius:'8px',cursor:'pointer',fontSize:'16px'};const messageStyle={color:'red',fontWeight:'bold'};export default Login;","map":{"version":3,"names":["React","useState","useRef","useNavigate","Link","axios","FiEye","FiEyeOff","jsx","_jsx","jsxs","_jsxs","Login","_ref","setIsAuthenticated","email","setEmail","password","setPassword","showPassword","setShowPassword","message","setMessage","emailRef","navigate","emailRegex","handleSubmit","e","preventDefault","current","focus","test","res","post","concat","process","env","REACT_APP_API_URL","data","status","role","application","expiryTime","Date","now","localStorage","setItem","toString","err","response","style","containerStyle","children","messageStyle","onSubmit","formStyle","ref","type","placeholder","value","onChange","target","inputStyle","position","_objectSpread","paddingRight","onClick","eyeButtonStyle","buttonStyle","to","fontSize","maxWidth","margin","padding","border","borderRadius","backgroundColor","fontFamily","display","flexDirection","gap","width","boxSizing","right","top","transform","background","cursor","color","fontWeight"],"sources":["/opt/myapp/qr-react-kotlin-app/frontend/src/components/Login.jsx"],"sourcesContent":["import React, { useState, useRef } from 'react';\nimport { useNavigate, Link } from 'react-router-dom';\nimport axios from 'axios';\nimport { FiEye, FiEyeOff } from 'react-icons/fi';\n\nconst Login = ({ setIsAuthenticated }) => {\n  const [email, setEmail] = useState('');\n  const [password, setPassword] = useState('');\n  const [showPassword, setShowPassword] = useState(false);\n  const [message, setMessage] = useState('');\n  const emailRef = useRef(null); // ref pour focus email\n  const navigate = useNavigate();\n\n  const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\n\n  const handleSubmit = async (e) => {\n    e.preventDefault();\n\n    if (!email || !password) {\n      setMessage('Please enter your email and password.');\n      setEmail('');\n      setPassword('');\n      if (emailRef.current) emailRef.current.focus();\n      return;\n    }\n\n    if (!emailRegex.test(email)) {\n      setMessage('Please enter a valid email address.');\n      setEmail('');\n      setPassword('');\n      if (emailRef.current) emailRef.current.focus();\n      return;\n    }\n\n\n    try {\n      const res = await axios.post(`${process.env.REACT_APP_API_URL}/api/login_web`, {\n        email,\n        password,\n      });\n\n      if (res.data.status === 'success') {\n        const role = res.data.role || '';\n        const application = res.data.application || '';\n        const expiryTime = Date.now() + 60 * 1000; // 1 minute pour test\n\n        localStorage.setItem('isAuthenticated', 'true');\n        localStorage.setItem('userEmail', email);\n        localStorage.setItem('userRole', role);\n        localStorage.setItem('userApplication', application);\n        localStorage.setItem('authExpiry', expiryTime.toString());\n\n        setIsAuthenticated(true, email, role, application);\n        setMessage('');\n\n        navigate('/'); // redirection après succès\n      } else {\n        setMessage(res.data.message || 'Unknown error.');\n        setEmail('');\n        setPassword('');\n        if (emailRef.current) emailRef.current.focus();\n      }\n    } catch (err) {\n      if (err.response && err.response.data && err.response.data.message) {\n        setMessage(err.response.data.message);\n      } else {\n        setMessage('Server or network error.');\n      }\n      setEmail('');\n      setPassword('');\n      if (emailRef.current) emailRef.current.focus();\n    }\n  };\n\n  return (\n    <div style={containerStyle}>\n      <h2>Login</h2>\n      {message && <p style={messageStyle}>{message}</p>}\n      <form onSubmit={handleSubmit} style={formStyle}>\n        <input\n          ref={emailRef}\n          type=\"text\"\n          placeholder=\"Email\"\n          value={email}\n          onChange={e => setEmail(e.target.value)}\n          style={inputStyle}\n        />\n        <div style={{ position: 'relative' }}>\n          <input\n            type={showPassword ? 'text' : 'password'}\n            placeholder=\"Password\"\n            value={password}\n            onChange={e => setPassword(e.target.value)}\n            style={{ ...inputStyle, paddingRight: '40px' }}\n          />\n          <button\n            type=\"button\"\n            onClick={() => setShowPassword(!showPassword)}\n            style={eyeButtonStyle}\n            aria-label={showPassword ? 'Hide password' : 'Show password'}\n          >\n            {showPassword ? <FiEyeOff /> : <FiEye />}\n          </button>\n        </div>\n        <button type=\"submit\" style={buttonStyle}>Login</button>\n      </form>\n      <p>\n        <Link to=\"/forgot-password\" style={{ fontSize: '14px' }}>Forgot password?</Link>\n      </p>\n      <p>\n        Don't have an account? <Link to=\"/signup\">Sign up</Link>\n      </p>\n    </div>\n  );\n};\n\n// Styles\nconst containerStyle = {\n  maxWidth: '400px',\n  margin: 'auto',\n  padding: '20px',\n  border: '1px solid #ddd',\n  borderRadius: '8px',\n  backgroundColor: '#f9faff',\n  fontFamily: \"'Segoe UI', Tahoma, Geneva, Verdana, sans-serif\",\n};\n\nconst formStyle = {\n  display: 'flex',\n  flexDirection: 'column',\n  gap: '15px',\n};\n\nconst inputStyle = {\n  padding: '10px',\n  fontSize: '16px',\n  borderRadius: '8px',\n  border: '1.5px solid #ccc',\n  width: '100%',\n  boxSizing: 'border-box',\n};\n\nconst eyeButtonStyle = {\n  position: 'absolute',\n  right: '10px',\n  top: '50%',\n  transform: 'translateY(-50%)',\n  background: 'transparent',\n  border: 'none',\n  cursor: 'pointer',\n  fontSize: '18px',\n};\n\nconst buttonStyle = {\n  backgroundColor: '#007bff',\n  color: '#fff',\n  fontWeight: 'bold',\n  border: 'none',\n  padding: '12px',\n  borderRadius: '8px',\n  cursor: 'pointer',\n  fontSize: '16px',\n};\n\nconst messageStyle = {\n  color: 'red',\n  fontWeight: 'bold',\n};\n\nexport default Login;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}